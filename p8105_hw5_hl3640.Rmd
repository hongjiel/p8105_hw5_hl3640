---
title: "Homework 5"
author: "Hongjie Liu"
output: github_document
---


Load necessary packages for homework 5.

```{r loadpackages, message = FALSE}
library(tidyverse)
```


## Problem 1

Load and tidy dataset.

```{r p1_loadtidy, message = FALSE}
arm_df = list.files(path = "./data/", pattern = "^[ce]", full.names = T) %>% 
  map(~ read_csv(.x) %>% 
        mutate(arm = .x)) %>% 
  bind_rows %>% 
  pivot_longer(
    cols = week_1:week_8,
    names_to = "week",
    names_prefix = "week_",
    values_to = "observation"
  ) %>% 
  mutate(
    week = as.numeric(week),
    arm = str_extract(arm, "[a-z]{3}_[0-9]{2}")
  ) %>% 
  separate(arm, into = c("arm", "subject_id"), sep = "_") %>% 
  filter(arm == "con")
```

Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.

```{r p1_plot}
arm_df %>% 
  ggplot(aes(x = week, y = observation, color = subject_id)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Observations on each subject over time",
    x = "Week",
    y = "Observation"
  )
```


## Problem 2

The data includes information of more than 52,000 criminal homicides over the past decade in 50 of the largest American cities. The raw data includes:

* uid;
* reported date;
* basic demographic information about each victim, including first name, last name, race, age, and sex;
* the location of the killing, including state, city, longitude, and latitude;
* whether an arrest was made.

Create a city_state variable and then summarize within cities to obtain the total number of homicides and the number of unsolved homicides (those for which the disposition is “Closed without arrest” or “Open/No arrest”). We assign the resulting dataset to `homicide_df`. We change one value of `city_state`, `Tulsa, AL`, to `Tulsa, OK`, because Tulsa is a city in Oklahoma, and the values of `uid`, `lat`, and `lon` indicate that the state should be `OK`.

```{r p2_readtidy, message = FALSE}
homicide_df =
  read_csv("./data/homicide-data.csv") %>% 
  unite(city_state, city:state, sep = ", ") %>% 
  mutate(city_state = replace(city_state, city_state == "Tulsa, AL", "Tulsa, OK")) %>% 
  group_by(city_state) %>% 
  summarize(
    n_obs = n(),
    n_unsolved_obs = sum(disposition %in% c("Closed without arrest", "Open/No arrest"))
  )

homicide_df
```
